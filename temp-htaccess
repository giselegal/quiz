# Configurações ultra-otimizadas para Hostinger (Apache)

# Habilitar reescrita de URL para SPA (crucial para React Router)
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Se o arquivo solicitado não existir fisicamente, redirecionar para index.html
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.html [L,QSA]
</IfModule>

# Definir tipos MIME corretos (crucial para resolver problemas de script loading)
<IfModule mod_mime.c>
    # JavaScript
    AddType application/javascript .js
    AddType application/javascript .jsx
    AddType application/javascript .mjs
    AddType application/javascript .ts
    AddType application/javascript .tsx
    
    # JSON
    AddType application/json .json
    
    # Imagens modernas
    AddType image/webp .webp
    AddType image/avif .avif
    AddType image/svg+xml .svg
    AddType image/png .png
    AddType image/jpeg .jpg .jpeg
</IfModule>

# Desabilitar sniffing de MIME types (resolver erro de import.meta)
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    
    # Cabeçalhos específicos para JavaScript
    <FilesMatch "\.(js|jsx|mjs|ts|tsx)$">
        Header set Content-Type "application/javascript; charset=UTF-8"
    </FilesMatch>
    
    # Cabeçalhos específicos para JSON
    <FilesMatch "\.json$">
        Header set Content-Type "application/json; charset=UTF-8"
    </FilesMatch>
    
    # Cabeçalhos específicos para CSS
    <FilesMatch "\.css$">
        Header set Content-Type "text/css; charset=UTF-8"
    </FilesMatch>
</IfModule>

# Ativar compressão para melhorar performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript application/javascript application/json image/svg+xml application/font-woff application/font-woff2 application/x-font-ttf font/opentype
    
    # Comprimir recursos adicionais
    AddOutputFilterByType DEFLATE application/xml text/xml application/xhtml+xml
    
    # Configuração de nível de compressão (9 = máximo)
    DeflateCompressionLevel 9
</IfModule>

# Configurar cache para recursos estáticos
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Cache para imagens e mídia (estendido para 6 meses)
    ExpiresByType image/jpeg "access plus 6 months"
    ExpiresByType image/png "access plus 6 months"
    ExpiresByType image/webp "access plus 6 months"
    ExpiresByType image/avif "access plus 6 months"
    ExpiresByType image/svg+xml "access plus 6 months"
    
    # Cache para arquivos de código
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/json "access plus 1 day"
    
    # Cache para fontes
    ExpiresByType font/ttf "access plus 6 months"
    ExpiresByType font/woff "access plus 6 months"
    ExpiresByType font/woff2 "access plus 6 months"
</IfModule>

# Permitir Cross-Origin para fontes e outros recursos
<IfModule mod_headers.c>
    <FilesMatch "\.(ttf|ttc|otf|eot|woff|woff2|font\.css)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>

# Configurações de segurança e performance adicionais
<IfModule mod_headers.c>
    # Segurança básica
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Permitir conexões de terceiros para Cloudinary
    Header always set Access-Control-Allow-Origin "https://res.cloudinary.com"
</IfModule>

# Cabeçalhos de segurança para proteger contra ataques comuns
<IfModule mod_headers.c>
    # Desabilitar cache para index.html para garantir atualizações
    <FilesMatch "index\.html$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
    
    # Habilitar cache para arquivos estáticos (cache estendido para 1 ano)
    <FilesMatch "\.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "public, max-age=31536000, immutable, stale-while-revalidate=86400"
    </FilesMatch>
</IfModule>

# Priorização de imagens críticas para otimizar o LCP
<IfModule mod_headers.c>
    # Imagens críticas para LCP
    <FilesMatch "\.(jpe?g|png|webp|avif|svg)$">
        Header set Priority "high"
        Header set Importance "high"
        Header add Link "</assets/images/ce883c46-80e0-4171-9c2d-9288f44f88eb-BSVDW0DB.png>; rel=preload; as=image; fetchpriority=high"
    </FilesMatch>
</IfModule>

# Carregamento síncrono para imagens críticas
<IfModule mod_headers.c>
    <FilesMatch "ce883c46-80e0-4171-9c2d-9288f44f88eb-BSVDW0DB\.png$">
        Header set Fetch-Mode "no-cors"
        Header set Fetch-Dest "image"
        Header set Loading-Strategy "eager"
    </FilesMatch>
</IfModule>

# Forçar recarga do navegador para índice principal
<IfModule mod_headers.c>
    <FilesMatch "^(index\.html)?$">
        Header set Clear-Site-Data "\"cache\""
    </FilesMatch>
</IfModule>

# Aumentar performance geral
<IfModule mod_headers.c>
    Header set Connection "keep-alive"
    Header set Keep-Alive "timeout=15, max=100"
</IfModule>
